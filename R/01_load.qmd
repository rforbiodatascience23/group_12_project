---
title: "01_load.qmd"
author: "Group12"
format: html
editor: visual
---

## Extract data

```{r load_libraries}

#| echo: false
#| message: false
#| warnin: false
library(tidyverse)

```

```{r get_data}
#| echo: false

filename <-  "DiseaseOutbreaks.zip"
filename2 <-  "WDICountry.csv"
dir_name <- "../_raw/"

if( !dir.exists(dir_name) ){
  dir.create(path = dir_name)
}

if ( !file.exists(str_c(dir_name, filename))) {
  print("No file named DiseaseOutbreaks.7z exists in directory _raw")
  break
} else if ( file.exists(str_c(dir_name, filename)) ){ 
  rawdons <- unzip(str_c("../_raw/",filename), files="DONsRaw.csv") |> 
    read.csv()
  covidoutbreaks <- unzip(str_c("../_raw/",filename), files="COVIDOutbreaks.csv") |> 
    read.csv()
outbreaks <- unzip(str_c("../_raw/",filename), files="Outbreaks.csv") |> 
    read.csv()
uniquedons <- unzip(str_c("../_raw/",filename), files="UniqueDONs.csv") |> 
    read.csv()
#icd1011 <- unzip(str_c("../_raw/",filename), files="icd1011.csv") |> 
    read.csv()
isocodes <- unzip(str_c("../_raw/",filename), files="isocodes.csv") |> 
    read.csv()
}
if ( !file.exists(str_c(dir_name, filename2))) {
  print("No file named WDICountry< exists in directory _raw")
} else if ( file.exists(str_c(dir_name, filename2)) ){ 
  wdi <- unzip(str_c("../_raw/",filename2), files="WDICountry.csv") |> 
    read.csv()
}


```

```{r merge and export data}
####we need to export data to an 01_dat_load_tsv fil on gitignore
#| echo: false

######## MERGE WDICountry to Outbreaks #########
outbreaks <- read.csv("~/projects/group_12_project/_raw/Outbreaks.csv") #this line can be deleted. WE NEED TO CHECK FILE NAMES ARE ALIGNED

wdi_clean <- wdi |> 
  select(Country.Code, Income.Group) |> 
  rename(iso3 = Country.Code) |> 
  filter(Income.Group !="")

outbreaks_wdi <-  
  left_join(outbreaks, wdi_clean, by = "iso3")

write.csv(outbreaks_wdi, "~/projects/group_12_project/_raw/outbreaks_wdi.csv")

```
